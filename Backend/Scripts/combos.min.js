(function(n,t){typeof define=="function"&&define.amd?define("Combo",["jquery"],function(i){return t(i,n)}):typeof exports=="object"&&typeof module!="undefined"?module.exports=t(require("jquery"),global||n):n.Combo=t(n.jQuery,n)})(this,function(n,t){var i=function(){var t=function(n){this.parseOptions(n);this.init()};return n.extend(t.prototype,{options:{name:"",view:"",cantItems:null,persist:!1,create:!1,actionController:"",actionControllerSelect:"",selectValue:null,search:null,cascadeCombo:null,removeValue:null,disable:!1,callback:null,change:null,minCantSearchChar:3,delimiter:","},init:function(){return Selectize.define("enter_key",function(){var n=this;this.onKeyDown=function(){var t=n.onKeyDown;return function(n){if(n.keyCode===188)n.preventDefault();else return t.apply(this,arguments)}}()}),this},createBasicCombo:function(){var t=this.options;n("#pnl"+t.name+t.view).load(t.actionController,{search:t.search,identif:"ddl"+t.name+t.view},function(i,r){if(r=="success"){var f=[],u=n("#ddl"+t.name+t.view).selectize({plugins:["remove_button","enter_key","drag_drop"],create:t.create,maxItems:t.cantItems,onChange:function(){var i=[],r=u[0].selectize.items,e=r.map(function(t){return n.inArray(t,f)>=0||i.push(t),u[0].selectize.options[t].text}).join(t.delimiter);n("#hSel"+t.name)&&n("#hSel"+t.name).val(e);n("#h"+t.name+t.view).val(i.join(t.delimiter));n("#h"+t.name+t.view).valid();n("#h"+t.name+t.view+"Like").val(f);t.cascadeCombo&&t.cascadeCombo();t.change&&t.change();t.callback&&t.callback()},onOptionAdd:function(n){isNaN(n)&&t.create&&f.push(n)},onOptionRemove:function(t){var i=n.inArray(t,f);i>=0&&f.splice(i,1)},render:{option_create:function(n,t){return'<div class="create">Crear <strong>'+t(n.input)+"<\/strong>&hellip;<\/div>"}}});u[0].selectize.clear(!0);t.removeValue&&u[0].selectize.removeOption(t.removeValue);u[0].selectize.order==0?(n("#h"+t.name+t.view).val(""),n("#hSel"+t.name)&&n("#hSel"+t.name).val(""),t.cascadeCombo&&t.cascadeCombo()):t.selectValue?u[0].selectize.setValue(t.selectValue):(n("#h"+t.name+t.view).val(""),t.cascadeCombo&&t.cascadeCombo());t.disable&&u[0].selectize.disable();t.callback&&t.callback()}else CargarAlertas(t.view)})},createSearchCombo:function(){var t=this.options,i=[],r=n("#ddl"+t.name+t.view).selectize({plugins:["remove_button","enter_key"],maxItems:t.cantItems,persist:!1,create:t.create,valueField:t.valueField,labelField:t.labelField,searchField:t.labelField,sortField:[{field:t.labelField,direction:"asc"},{field:"$score"}],options:[],onChange:function(r){var u=[];r!=null&&(n.isArray(r)?r.forEach(function(t){n.inArray(t,i)>=0||u.push(t)}):u.push(r));n("#h"+t.name+t.view).val(u.join(t.delimiter));n("#h"+t.name+t.view).valid();n("#h"+t.name+t.view+"Like").val(i);t.change&&t.change()},score:function(i){var u=this.getScoreFunction(i),r=this;return function(f){if(i.length<t.minCantSearchChar){if(r.loadedSearches={"":!0},n.inArray(f.Id.toString(),r.items)<0)return r.removeOption(f.Id),0}else return u(f)}},load:function(i,r){var u=this;if(!i.length)return r();i.length>=t.minCantSearchChar?n.ajax({url:t.actionController,type:"GET",dataType:"json",data:{q:i},error:function(){r()},success:function(n){r(n.aaData)}}):r()},onInitialize:function(){var i=this;t.selectValue?i.load(function(r){n.ajax({url:t.actionControllerSelect,type:"GET",dataType:"json",data:{q:t.selectValue.toString()},error:function(){r()},success:function(u){r(u.aaData);i.setValue(t.selectValue);n("#h"+t.name+t.view).val(t.selectValue.toString())}})}):n("#h"+t.name+t.view).val("");t.disable&&i.disable()},onOptionAdd:function(n){isNaN(n)&&t.create&&i.push(n)},onOptionRemove:function(t){var r=n.inArray(t,i);r>=0&&i.splice(r,1)},render:{option_create:function(n,t){return'<div class="create">Buscar <strong>'+t(n.input)+"<\/strong>&hellip;<\/div>"}}})},parseOptions:function(i,r){var e,u,f,o;for(this.options=n.extend(!0,{},t.prototype.options),e=[i,r],f=0;f<e.length;f++){if(u=e[f],typeof u=="undefined")break;if(typeof u!="object")this.options.text=u;else for(o in u)this.options[o]=u[o]}}}),t};return i(t)});