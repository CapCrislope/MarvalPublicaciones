@model DistribucionUtilidades.Models.VM.CargaDeImportesVM

@{ string identif = "_CargaDeImportes";
}


<div id="AlertsCargaDeImportes"></div>

<div class="row mb-3">
    <div class="col-md-12">
        <div>
            @{
                if (ViewBag.TipoProceso == 1)
                {
                    <h3>Carga de importes (Proceso Real)</h3>
                }
                else
                {
                    <h3 style="color:#ff6a00">Carga de importes (Proceso Provisorio)</h3>
                }
            }
        </div>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-12">
        @{
            if (ViewBag.TipoProceso == 1)
            {
                <p class="leyenda">Ingrese los importes correspondientes a cada socio, definidos y aprobados por la asamblea.</p>
            }
            else
            {
                <p class="leyenda">Ingrese los importes estimados correspondientes a cada socio.</p>
            }

            <p class="leyenda">En caso de ser necesario, agregue el socio o exsocio que no figure en el listado e ingrese su importe correspondiente haciendo click en el botón “Agregar Socio”.</p>
        }
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <p style="border: solid 1px #e9b676; padding: 20px; background-color: #fff4e0; border-radius: 5px;">
        Las modificaciones que realice sobre este modulo solo quedarán almacenadas cuando presione sobre el botón "Guardar", cualquier cambio sin guardar se perderá al salir de esta pantalla.
        </p>
    </div>
</div>


<form id="CargaDeImportesForm" onsubmit="GuardarImportes(); return false;">

    @Html.HiddenFor(model => model.Modo)
    @Html.HiddenFor(model => model.Ejercicio, new { id = "hEjercicio" + identif, @class = "IncludeHidden" })
    @Html.HiddenFor(model => model.IdImporteProceso)


    @{ if (Model.Modo == "ALTA")
        {

            <div class="row mt-3 mb-3">
                <div class="col-md-4"></div>
                <div class="form-group-sm col-md-4">
                    <label for="ddEjercicio@{@identif}">Ejercicio</label>
                    <div id="pnlEjercicio@{@identif}">
                        @*<img src="~/Images/loading.gif" />*@
                    </div>
                    @Html.ValidationMessageFor(model => model.Ejercicio)
                </div>
                <div class="col-md-4"></div>
            </div>

    }
    else
    {

            <div class="row mt-3 mb-3">
                <div class="col-md-1"></div>
                <div class="form-group-sm col-md-4">
                    <label>Ejercicio</label>
                    <div>@ViewBag.Ejercicio</div>
                </div>
                <div class="col-md-7"></div>
            </div>

        }
    }


    @{ if (Model.Modo == "EDICION")
        {
            <div class="row mt-3 mb-4">
                <div class="col-md-1"></div>
                <div class="form-group-sm col-md-4" style="color: #db2121; font-size: 16px;">
                    <label>Nota de Revisión</label>
                    @{if (Model.NotaRevision != "" && Model.NotaRevision != null)
                        {
                            <div>@Model.NotaRevision</div>
                        }
                        else
                        {
                            <div>-</div>
                        }


                    }

                </div>
                <div class="col-md-7"></div>
            </div>
        }
    }
            <div class="row">
                <div class="col-md-1"></div>
                <div class="col-md-4">
                    <label>Excel socios importes</label>
                    <div class="custom-file">

                        <input type="file" class="custom-file-input" name="excelFile" id="excelFile" accept=".xls, .xlsx" lang="es">
                        <label class="custom-file-label" for="customFileLang">Seleccionar Archivo</label>
                    </div>
                    <div> <a href="~/Templates/CargaDeImportes.xlsx" target="_blank">Descargar Template</a></div>
                </div>
                <div class="col-md-1">
                    <div>
                        <button id="btnCargarExcel" type="button" class="btn btn-primary btn-sm" style="margin-top:30px;" onclick="ValidarDatosExcel()">Cargar</button>
                    </div>
                </div>
                <div class="col-md-3"></div>
                <div class="col-md-2 der">
                    <div class="mt-5">
                        <button type="button" class="btn btn-primary btn-sm" onclick="ModalAgregarSocio();">Agregar socio</button>
                    </div>
                </div>
            </div>
    <div class="row mt-3">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <table id="ImportesSocioTable" class="table">
                <thead class="thead-dark">
                    <tr>
                        <th width="70%" scope="col">Socio/Ex-Socio</th>
                        <th width="20%" scope="col">Importe</th>
                        <th width="10%"></th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        if (Model.Socios.Count > 0)
                        {
                            for (int i = 0; i < Model.Socios.Count; i++)
                            {

                                <tr id="@Model.Socios[i].PersonaId" data-type="Socio" data-row="@i">
                                    <td>@Model.Socios[i].Socio</td>
                                    <td>
                                        <div>
                                            @Html.EditorFor(model => Model.Socios[i].Importe, new { htmlAttributes = new { @class = "form-control form-control-sm", @type = "number", @min = "0", @Id = "Importe_" + Model.Socios[i].PersonaId + "", @data_type = "Socio", @onChange = "sumByType(this)", @pattern = "[0-9]*", @data_politespace = "", @data_politespace_prefix = "$ ", @data_politespace_reverse = "" } })
                                            @Html.ValidationMessageFor(model => Model.Socios[i].Importe)
                                        </div>

                                    </td>
                                    <td style="text-align: right">
                                        <button type="button" class="btn btn-light btn-xs ml-1" data-id="" onClick="BorrarSocio('@Model.Socios[i].PersonaId'); return false;" title="Quitar">
                                            <span class="fa fa-times fa-1" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                </tr>
                            }
                        }

                        <tr id="totalSocios" class="table-info">
                            <td>Total socios</td>
                            <td>
                                @*<div>
                                    @Html.EditorFor(model => model.TotalSocios, new { htmlAttributes = new { @class = "form-control form-control-sm", @type = "number", @min = "0", @id = "Importe_TotalSocios", @pattern = "[0-9]*", @data_politespace = "", @data_politespace_prefix = "$ ", @data_politespace_reverse = "" } })
                                    @Html.ValidationMessageFor(model => model.TotalSocios)
                                </div>*@

                                <div id="TotalSocios" data-val="@Model.TotalSocios">
                                    $ @Model.TotalSocios.ToString("N0")
                                </div>
                            </td>
                            <td></td>
                        </tr>

                        if (Model.ExSocios.Count > 0)
                        {

                            for (int i = 0; i < Model.ExSocios.Count; i++)
                            {

                                <tr id="@Model.ExSocios[i].PersonaId" data-type="ExSocio" data-row="@i">
                                    <td>@Model.ExSocios[i].Socio</td>
                                    <td>
                                        <div>
                                            @Html.EditorFor(model => Model.ExSocios[i].Importe, new { htmlAttributes = new { @class = "form-control form-control-sm", @type = "number", @min = "0", @Id = "Importe_" + Model.ExSocios[i].PersonaId + "", @data_type = "ExSocio", @onChange = "sumByType(this)", @pattern = "[0-9]*", @data_politespace = "", @data_politespace_prefix = "$ ", @data_politespace_reverse = "" } })
                                            @Html.ValidationMessageFor(model => Model.ExSocios[i].Importe)
                                        </div>

                                    </td>
                                    <td style="text-align: right">
                                        <button type="button" class="btn btn-light btn-xs ml-1" data-id="" onClick="BorrarSocio('@Model.ExSocios[i].PersonaId'); return false;" title="Quitar">
                                            <span class="fa fa-times fa-1" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                </tr>
                            }


                        }
                        <tr id="totalExSocios" class="table-info">
                            <td>Total ExSocios</td>
                            <td>
                                @*@Html.EditorFor(model => model.TotalExSocios, new { htmlAttributes = new { @class = "form-control form-control-sm", @type = "number", @min = "0", @id = "Importe_TotalExSocios", @pattern = "[0-9]*", @data_politespace = "", @data_politespace_prefix = "$ ",  @data_politespace_reverse = "" } })
                                @Html.ValidationMessageFor(model => model.TotalExSocios)*@
                                      <div id="TotalExSocios" data-val="@Model.TotalExSocios">
                                    $ @Model.TotalExSocios.ToString("N0")
                                </div>
                               
                            </td>
                            <td></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="col-md-1"></div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <button type="submit" class="btn btn-primary btn-sm mx-auto d-block pl-3 pr-3 mt-5">Guardar</button>
        </div>
    </div>
</form>

<partial name="_ValidationScriptsPartial" />

<environment include="Development">
    <script src="~/js/CargaDeImportes.js" asp-append-version="true"></script>
</environment>
<environment exclude="Development">
    <script src="~/js/CargaDeImportes.min.js" asp-append-version="true"></script>
</environment>

<script type="text/javascript">

    $(document).ready(function () {
        var modo = '@Model.Modo';

        $('#excelFile').on('change',
            function (e) {
                //get the file name
                //;
                var fileName = e.target.files[0].name;

                //replace the "Choose a file" label
                $(this).next('.custom-file-label').html(fileName);
            })

        if (modo == 'ALTA') {
            ComboEjercicio();
        }

        $("input[type=number]").politespace();
    })

</script>