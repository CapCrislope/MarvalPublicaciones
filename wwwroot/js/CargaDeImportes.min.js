function ComboEjercicio(){new Combo({name:"Ejercicio",view:"_CargaDeImportes",actionController:"/Finanzas/LlenarComboEjercicio",cantItems:1}).createBasicCombo()}function ModalAgregarSocio(){$("#dialog").load("/Finanzas/ModalAgregarSocio",function(n,t){t=="success"?$("#dialog").modal("show"):CargarAlertas(frmHome)})}function BorrarSocio(n){var i=$("#"+n).attr("data-type"),t=0;$('#ImportesSocioTable tbody tr[id="'+n+'"]').remove();$("[data-type='"+i+"'][id^= 'Importe_']").each(function(n,i){var r=$("#"+i.id).val();r==""&&(r=0);t=t+parseInt(r)});i=="Socio"?($("#TotalSocios").attr("data-val",t),$("#TotalSocios").text("$ "+t.toLocaleString())):($("#TotalExSocios").attr("data-val",t),$("#TotalExSocios").text("$ "+t.toLocaleString()))}function ComboSocio(){new Combo({name:"Socio",view:"_ModalAgregarSocio",actionController:"/Finanzas/LlenarComboSociosYExSocios",valueField:"Id",labelField:"Descripcion",cantItems:1}).createSearchCombo()}function AgregarSocio(){var n=$("#hSocio_ModalAgregarSocio").val(),t=$("#chkForzarSocio").prop("checked");n!=""?$("#ImportesSocioTable tbody tr[id="+n+"]").length==0?$.post("/Finanzas/AgregarSocio",{IdPersona:n}).done(function(n){n.IsEverythingGood==!0&&(t&&(n.Socio.SocioEgreso=!1),AddRowTable(n.Socio),$("#dialog").modal("hide"))}).always(function(){CargarAlertas(frmCargaImportes)}):Danger("El Socio/ExSocio ya esta cargado."):Danger("Debe elergir un Socio/ExSocio del combo.")}function ValidarDatosExcel(){if($("#btnCargarExcel").prop("disabled",!0),$("#excelFile")[0].files[0]!=null){var n=new FormData;n.append("file",$("#excelFile")[0].files[0]);$.ajax({type:"POST",url:"/Finanzas/ValidarDatosExcel",data:n,cache:!1,contentType:!1,processData:!1,success:function(n){CargarAlertas(frmHome);n.isEverythingGood&&($("#CargaDeImportesForm")[0].reset(),drawItemTable(n.lista))},error:function(){CargarAlertas(frmHome)},complete:function(){$("#CargaDeImportesForm")[0].reset();$(".custom-file-label").html("Seleccionar Archivo");$("#btnCargarExcel").prop("disabled",!1)}})}else Danger("Debe cargar un archivo."),$("#btnCargarExcel").prop("disabled",!1)}function drawItemTable(n){$("#ImportesSocioTable > tbody").empty();$("#ImportesSocioTable > tbody").load("/Finanzas/CargaImportesDesdeExcel",{Lista:n},function(n,t){t=="success"||CargarAlertas(frmHome)})}function AddRowTable(n){var i,r,t,u;n.SocioEgreso?(t=$("#ImportesSocioTable").find("tr[data-type=ExSocio]").last().attr("data-row"),r=t==undefined?1:parseInt(t)+1):(t=$("#ImportesSocioTable").find("tr[data-type=Socio]").last().attr("data-row"),i=t==undefined?1:parseInt(t)+1);u="";u+=' <tr id="'+n.PersonaId+'" data-type="'+(n.SocioEgreso?"ExSocio":"Socio")+'" data-row="'+(n.SocioEgreso?r:i)+'">        <td>'+n.Socio+'<\/td>        <td><div>        <input class="form-control form-control-sm text-box single-line" data-val="true" data-val-regex="El numero debe ser un entero." data-val-regex-pattern="([0-9][0-9]*)" id="Importe_'+n.PersonaId+'"onChange=sumByType(this) data-type="'+(n.SocioEgreso?"ExSocio":"Socio")+'" min="0" name="'+(n.SocioEgreso?"ExSocios["+r+"]":"Socios["+i+"]")+'.Importe" type="number" pattern="[0-9]*" data-politespace="" data-politespace-prefix="$ " data-politespace-reverse="" >            <span class="field-validation-valid" data-valmsg-for="'+(n.SocioEgreso?"ExSocios["+r+"]":"Socios["+i+"]")+'.Importe" data-valmsg-replace="true"><\/span>             <\/div>        <\/td>        <td style="text-align: right"><button type="button" class="btn btn-light btn-xs ml-1" data-id="'+n.PersonaId+'" onClick="BorrarSocio(\''+n.PersonaId+'\'); return false;" title="Quitar">             <span class="fa fa-times fa-1" aria-hidden="true"><\/span>             <\/button><\/td>    <\/tr>';n.SocioEgreso?$("#ImportesSocioTable #totalExSocios").before(u):$("#ImportesSocioTable #totalSocios").before(u);$("#CargaDeImportesForm").data("validator",null);$.validator.unobtrusive.parse($("#CargaDeImportesForm"));$("#Importe_"+n.PersonaId).politespace()}function GetDataForm(){return{Modo:$("#Modo").val(),Ejercicio:$("#hEjercicio_CargaDeImportes").val(),Socios:GetSocios(),ExSocios:GetExSocios(),TotalSocios:$("#TotalSocios").attr("data-val"),TotalExSocios:$("#TotalExSocios").attr("data-val"),IdImporteProceso:$("#IdImporteProceso").val()}}function GuardarImportes(){var n=GetDataForm();$("#CargaDeImportesForm").valid()?ValidImporte(n.Socios)&&ValidImporte(n.ExSocios)&&n.TotalSocios!=""&&n.TotalExSocios!=""?$.post("/Finanzas/GuardarImportes",n).done(function(n){n.IsEverythingGood==!0&&CargarMenu()}).always(function(){CargarAlertas(frmCargaImportes)}):Danger("Corrobore los importes. Los mismos no pueden ser valores nulos."):Danger("Por favor verifique los datos ingresados.")}function ValidImporte(n){if(n.length>0)for(var t=0;t<n.length;t++)if(n[t].Importe=="")return!1;return!0}function ObjPersona(){return{PersonaId:null,Importe:null,SocioEgreso:null}}function GetExSocios(){var n=[];return $("#ImportesSocioTable tbody tr[data-type='ExSocio']").each(function(t,i){var r=ObjPersona(),u=i.id,f=$("#Importe_"+u).val();r.PersonaId=u;r.Importe=f;r.SocioEgreso=!0;n.push(r)}),n}function GetSocios(){var n=[];return $("#ImportesSocioTable tbody tr[data-type='Socio']").each(function(t,i){var r=ObjPersona(),u=i.id,f=$("#Importe_"+u).val();r.PersonaId=u;r.Importe=f;r.SocioEgreso=!1;n.push(r)}),n}function sumByType(n){var t=0,i=n.dataset.type;n.value==""&&$("#"+n.id).val("0");$("[data-type='"+i+"'][id^= 'Importe_']").each(function(n,i){var r=$("#"+i.id).val();r==""&&(r=0);t=t+parseInt(r)});i=="Socio"?($("#TotalSocios").attr("data-val",t),$("#TotalSocios").text("$ "+t.toLocaleString())):($("#TotalExSocios").attr("data-val",t),$("#TotalExSocios").text("$ "+t.toLocaleString()))}var frmCargaImportes="CargaDeImportes";